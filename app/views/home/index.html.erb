<h1>Home#index</h1>
<% if user_signed_in? %>
    <li>
      <%= link_to('Logout', destroy_user_session_path, method: :delete) %>
    </li>
<% else %>
    <li>
      <%= link_to('Login', new_user_session_path) %>
    </li>
<% end %>

<p>Total Meal: <strong><%= @total_meal %></strong></p>
<p>Total Deposit: <strong><%= @total_deposit %></strong></p>
<p>Meal Rate: <strong><%= (@total_deposit / @total_meal).round(2) %></strong></p>
<p>Total member: <strong><%= Member.count %></strong></p>

<% @members.each do |member| %>
    <%
      member_breakfasts = []
      member_lunches = []
      member_dinners = []
      member_guests = []
      member_meals = Meal.where("user_id = ? AND member_id = ?", current_user, member.id)
      member_meals.each do |member_meal|
        member_breakfast = member_meal.breakfast
        member_breakfasts << member_breakfast
        member_lunch = member_meal.lunch
        member_lunches << member_lunch
        member_dinner = member_meal.dinner
        member_dinners << member_dinner
        member_guest = member_meal.guest
        member_guests << member_guest
      end
      total_member_breakfast = member_breakfasts.inject(0){|sum, a| sum + a}
      total_member_lunch = member_lunches.inject(0){|sum, a| sum + a}
      total_member_dinner = member_dinners.inject(0){|sum, a| sum + a}
      total_member_guest = member_guests.inject(0){|sum, a| sum + a}
      total = total_member_breakfast + total_member_lunch + total_member_dinner + total_member_guest

       %>
    <p>
      <%= member.name %>
      | breakfast: <%= total_member_breakfast %>
      | lunch: <%= total_member_lunch %>
      | dinner: <%= total_member_dinner %>
      | guest: <%= total_member_guest %>
      | total: <%= total %>
      | expence: <%= (total * (@total_deposit / @total_meal)).round(2) %>
    </p>
<% end %>

